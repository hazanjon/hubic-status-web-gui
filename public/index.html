<!DOCTYPE html>
<html>
	<head>
		<script src="./config.js"></script>
		<script src="http://js.pusher.com/2.1/pusher.min.js"></script>
		<script src="http://cdnjs.cloudflare.com/ajax/libs/knockout/3.0.0/knockout-min.js"></script>
	</head>
	<body>
		
		<!-- ko with: status -->
			<h1>Hubic Status</h1>
		
			<div>
				Account: <span data-bind="text: account"></span>
			</div>
			<div>
				Space Used: <span data-bind="text: spaceUsed"></span>
			</div>
			<div>
				Sync Dir: <span data-bind="text: syncDir"></span>
			</div>
		
		
			<h1>Uploads</h1>
			
			<!-- ko with: upload -->
				<div>
					Upload Speed: <span data-bind="text: speed"></span>
				</div>
				<div>
					Queue Count: <span data-bind="text: queue.count"></span><br />
					Queue Size: <span data-bind="text: queue.size"></span>
				</div>
				
				<h3>Queue</h3>
				<!-- ko if: operations.length == 0 -->
					Queue Empty
				<!-- /ko -->
				<div data-bind="foreach: operations">
					<span data-bind="text: dir"></span><span data-bind="text: file"></span> (<span data-bind="text: progress"></span>/<span data-bind="text: size"></span>)<br />
				</div>
			<!-- /ko -->
		
			<h1>Downloads</h1>
			
			<!-- ko with: download -->
				<div>
					Upload Speed: <span data-bind="text: speed"></span>
				</div>
				<div>
					Queue Count: <span data-bind="text: queue.count"></span><br />
					Queue Size: <span data-bind="text: queue.size"></span>
				</div>
				
				<h3>Queue</h3>
				
				<!-- ko if: operations.length == 0 -->
					Queue Empty
				<!-- /ko -->
				<div data-bind="foreach: operations">
					<span data-bind="text: file"></span><br />
				</div>
			<!-- /ko -->
		
		
		<!-- /ko -->
		
		
		<script>
			var pusher = new Pusher(config.pusherAppId);
			var channel = pusher.subscribe('status_channel');
			
			var hubic = hubic || {};
			
			var viewModel = function(){
				self = this;
				self.status = ko.observable();
			}
			
			hubic.vm = new viewModel();
			
			channel.bind('status_update', function(data) {
				hubic.vm.status(data);
				console.log(data);
			});
			
			ko.applyBindings(hubic.vm);
		</script>
	</body>
	
</html>